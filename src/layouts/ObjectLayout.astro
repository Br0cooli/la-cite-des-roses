---
import BaseLayout from "@layouts/BaseLayout.astro";

interface MetaObjet {
  name: string;
  subtitle?: string;
  typeLabel?: string;
  owner?: string;
  origin?: string;
  rarity?: string;
  image?: string;
}

interface Props {
  meta?: MetaObjet;

  name?: string;
  subtitle?: string;
  typeLabel?: string;
  owner?: string;
  origin?: string;
  rarity?: string;
  image?: string;

  basePath: string;       // ex: "/univers/objets/mouchoir-leandre"
  currentSection: string; // "general", "origine", "fonctionnement", "owners", "galerie"
}

const props = Astro.props as Props;

const normalizedBasePath = (props.basePath || "").replace(/\/+$/, "");

// on merge : props.directs > meta.json > vide
const name = props.name ?? props.meta?.name ?? "";
const subtitle = props.subtitle ?? props.meta?.subtitle;
const typeLabel = props.typeLabel ?? props.meta?.typeLabel;
const owner = props.owner ?? props.meta?.owner;
const origin = props.origin ?? props.meta?.origin;
const rarity = props.rarity ?? props.meta?.rarity;
const image = props.image ?? props.meta?.image;

const currentSection = props.currentSection;

const sections = [
  { id: "general",        label: "Général" },
  { id: "origine",        label: "Origine & fabrication" },
  { id: "fonctionnement", label: "Fonctionnement" },
  { id: "owners",         label: "Possesseurs" },
  { id: "galerie",        label: "Galerie" },
];
---


<BaseLayout title={name ? `${name} — Objet` : "Objet"}>
  <section class="card object-page">

    <!-- HEADER OBJET COMMUN À TOUTES LES PAGES -->
    <header class="object-header">
      <div class="object-header-text">
        {typeLabel && (
          <p class="object-type">
            {typeLabel}
          </p>
        )}

        <h1 class="object-name">
          {name}
        </h1>

        {subtitle && (
          <p class="object-subtitle">
            {subtitle}
          </p>
        )}

        <div class="object-meta-row">
          {owner && (
            <span class="object-meta-pill">
              Possesseur&nbsp;: {owner}
            </span>
          )}
          {origin && (
            <span class="object-meta-pill">
              Origine&nbsp;: {origin}
            </span>
          )}
          {rarity && (
            <span class="object-meta-pill">
              Rareté&nbsp;: {rarity}
            </span>
          )}
        </div>
      </div>

      {image && (
        <div class="object-header-image">
          <img src={image} alt={name} loading="lazy" />
        </div>
      )}
    </header>

    <!-- LAYOUT : NAV LATÉRALE + CONTENU -->
    <div class="object-layout">
      <aside class="object-sidebar">
        <nav class="object-nav">
          {sections.map((s) => (
            <a
              href={`${normalizedBasePath}/${s.id}`}
              class={
                "object-nav-link" +
                (currentSection === s.id ? " is-active" : "")
              }
            >
              {s.label}
            </a>
          ))}
        </nav>
      </aside>

      <div class="object-content">
        <slot />
      </div>
    </div>
  </section>
</BaseLayout>
