---
import BaseLayout from "@layouts/BaseLayout.astro";

interface Props {
  name: string;
  subtitle?: string;
  typeLabel?: string;
  owner?: string;
  origin?: string;
  rarity?: string;
  image?: string;
  basePath: string; // ex: "/univers/objets/mouchoir-leandre"
  currentSection: string; // "general", "origine", etc.
  children: AstroSlots["default"];
}

const {
  name,
  subtitle,
  typeLabel,
  owner,
  origin,
  rarity,
  image,
  basePath,
  currentSection,
} = Astro.props as Props;

// Nettoie le basePath pour éviter les doubles / à la fin
const normalizedBasePath = (basePath || "").replace(/\/+$/, "");

// Sections de la nav latérale
const sections = [
  { id: "general", label: "Général" },
  { id: "origine", label: "Origine & fabrication" },
  { id: "fonctionnement", label: "Fonctionnement" },
  { id: "owners", label: "Possesseurs" },
  { id: "galerie", label: "Galerie" },
];
---

<BaseLayout title={name ? `${name} — Objet` : "Objet"}>
  <div class="card">
    {/* HEADER OBJET */}
    <header class="object-header">
      <div class="object-header-text">
        {typeLabel && (
          <p class="object-type">
            {typeLabel}
          </p>
        )}

        <h1 class="object-name">
          {name}
        </h1>

        {subtitle && (
          <p class="object-subtitle">
            {subtitle}
          </p>
        )}

        <div class="object-meta-row">
          {owner && (
            <span class="object-meta-pill">
              Possesseur&nbsp;: {owner}
            </span>
          )}
          {origin && (
            <span class="object-meta-pill">
              Origine&nbsp;: {origin}
            </span>
          )}
          {rarity && (
            <span class="object-meta-pill">
              Rareté&nbsp;: {rarity}
            </span>
          )}
        </div>
      </div>

      {image && (
        <div class="object-header-image">
          <img src={image} alt={name} loading="lazy" />
        </div>
      )}
    </header>

    {/* LAYOUT : SIDEBAR + CONTENU */}
    <div class="object-layout">
      <aside class="object-sidebar">
        <nav class="object-nav">
          {sections.map((s) => (
            <a
              href={`${normalizedBasePath}/${s.id}`}
              class={
                "object-nav-link" +
                (currentSection === s.id ? " is-active" : "")
              }
            >
              {s.label}
            </a>
          ))}
        </nav>
      </aside>

      <div class="object-content">
        <slot />
      </div>
    </div>
  </div>
</BaseLayout>
