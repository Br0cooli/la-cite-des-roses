---
import BaseLayout from "@layouts/BaseLayout.astro";
import dashboard from "@data/dashboard.json";

interface TodoItem {
  label: string;
  area?: string;   // "Personnages", "Lieux", "Scénario", etc.
  link?: string;   // lien vers la page concernée (optionnel)
  status?: string; // "à faire", "en cours", "relecture", etc.
}

interface TodoSection {
  title: string;       // "Prioritaire", "Quand j'ai le temps", etc.
  items: TodoItem[];
}

interface RecentDoc {
  label: string;       // "Fiche Delia — stats", "Aureval — économie"...
  type?: string;       // "Personnage", "Lieu", "Objet", "Scénario", etc.
  path: string;        // URL vers la page
  note?: string;       // pourquoi c'est là / quoi faire dessus
}

interface DashboardData {
  focusTitle?: string;
  focusNote?: string;

  todoSections?: TodoSection[];
  recentDocs?: RecentDoc[];
  scratchpadIdeas?: string[]; // mini-brain dump d'idées du moment
}

const data = dashboard as DashboardData;
---

<BaseLayout title="La Cité des Roses — Tableau de bord">
  <section class="card home-dashboard">
    <header class="page-header">
      <div class="page-header-main">
        <h1 class="page-title">Tableau de bord</h1>
        <p class="page-subtitle">
          Espace de travail.
        </p>
      </div>
    </header>

    <div class="dashboard-grid">
      <!-- FOCUS DU MOMENT -->
      <section class="object-block dashboard-focus">
        <h2 class="object-block-title">
          {data.focusTitle || "Focus du moment"}
        </h2>

        {data.scratchpadIdeas && data.scratchpadIdeas.length > 0 && (
          <ul class="object-notes">
            {data.scratchpadIdeas.map((idea) => (
              <li>{idea}</li>
            ))}
          </ul>
        )}
      </section>

      <!-- TO-DO LIST -->
      <section class="object-block dashboard-todo">
        <h2 class="object-block-title">To-do</h2>

        {!data.todoSections || data.todoSections.length === 0 ? (
          <p class="object-empty">
            Aucune tâche pour l’instant.<br />
            Ajoute des sections dans <code>dashboard.json</code> pour suivre
            ce que tu dois faire.
          </p>
        ) : (
          <div class="dashboard-todo-columns">
            {data.todoSections.map((section) => (
              <div class="dashboard-todo-section">
                <h3 class="dashboard-todo-title">{section.title}</h3>
                <ul class="dashboard-todo-list">
                  {section.items.map((item) => (
                    <li class="dashboard-todo-item">
                      {item.link ? (
                        <a href={item.link} class="dashboard-todo-link">
                          <span class="dashboard-todo-label">{item.label}</span>
                        </a>
                      ) : (
                        <span class="dashboard-todo-label">{item.label}</span>
                      )}

                      <div class="dashboard-todo-meta">
                        {item.area && (
                          <span class="place-meta-pill">
                            {item.area}
                          </span>
                        )}
                        {item.status && (
                          <span class="place-meta-pill">
                            {item.status}
                          </span>
                        )}
                      </div>
                    </li>
                  ))}
                </ul>
              </div>
            ))}
          </div>
        )}
      </section>

      <!-- DERNIERS AJOUTS / À REPRENDRE -->
      <section class="object-block dashboard-recents">
        <h2 class="object-block-title">Derniers ajouts</h2>

        {!data.recentDocs || data.recentDocs.length === 0 ? (
          <p class="object-empty">
            Rien pour l’instant.<br />
            Ajoute des entrées dans <code>recentDocs</code> dans
            <code>dashboard.json</code> pour garder en vue ce sur quoi tu travailles.
          </p>
        ) : (
          <ul class="dashboard-recents-list">
            {data.recentDocs.map((doc) => (
              <li class="dashboard-recents-item">
                <a href={doc.path} class="dashboard-recents-link">
                  <div class="dashboard-recents-main">
                    <span class="dashboard-recents-label">{doc.label}</span>
                    {doc.type && (
                      <span class="place-meta-pill">
                        {doc.type}
                      </span>
                    )}
                  </div>
                  {doc.note && (
                    <p class="dashboard-recents-note">
                      {doc.note}
                    </p>
                  )}
                </a>
              </li>
            ))}
          </ul>
        )}
      </section>
    </div>
  </section>
</BaseLayout>
