---
import BaseLayout from "@layouts/BaseLayout.astro";

interface ScenarioMeta {
  title: string;
  subtitle?: string;
  mainTag?: string;
  secondaryTag?: string;
  moodTag?: string;
  extraTags?: string[];
  headerImage?: string;

  // Optionnels mais utiles pour l’index :
  summary?: string;        // courte description pour la card
  highlights?: string[];   // puces pour la card
}

// On charge tous les meta.json des documents de scénario
const modules = import.meta.glob("@data/scenario/*/meta.json", {
  eager: true
});

const docs = Object.entries(modules)
  .map(([path, mod]) => {
    const data = (mod as any).default ?? mod;
    const meta = data as ScenarioMeta;

    const match = path.match(/scenario\/([^/]+)\/meta\.json$/);
    const slug = match ? match[1] : "";

    return {
      slug,
      meta
    };
  })
  // tu peux trier si tu veux (par titre par ex)
  .sort((a, b) => a.meta.title.localeCompare(b.meta.title));
---

<BaseLayout title="Scénario — La Cité des Roses">
  <section class="card">
    <header class="page-header">
      <div class="page-header-main">
        <h1 class="page-title">Scénario</h1>
        <p class="page-subtitle">
          Index des documents de travail narratifs.
        </p>
      </div>
    </header>

    {docs.length === 0 && (
      <p class="object-empty">
        Aucun document de scénario trouvé.<br />
        Ajoute des dossiers dans <code>src/data/scenario/&lt;slug&gt;/meta.json</code>
        pour qu’ils apparaissent ici.
      </p>
    )}

    {docs.length > 0 && (
      <div class="scenario-index-grid">
        {docs.map(({ slug, meta }) => (
          <a
            href={`/univers/scenario/${slug}`}
            class="home-block scenario-block"
          >
            <h2>{meta.title}</h2>

            {/* description de la card : on privilégie summary, sinon subtitle */}
            {meta.summary ? (
              <p>{meta.summary}</p>
            ) : meta.subtitle ? (
              <p>{meta.subtitle}</p>
            ) : null}

            {/* Liste de points si présente */}
            {meta.highlights && meta.highlights.length > 0 && (
              <ul class="home-list">
                {meta.highlights.map((item) => (
                  <li>{item}</li>
                ))}
              </ul>
            )}
          </a>
        ))}
      </div>
    )}
  </section>
</BaseLayout>
